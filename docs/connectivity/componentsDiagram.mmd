---
config:
  layout: elk
  theme: neo-dark
---
flowchart TB
 subgraph CORE["ğŸ’¾ Core Application"]
        PID["PID Controller<br>ğŸ“Š Sensor PT100"]
        SENSOR["Temperature Sensor<br>ğŸŒ¡ï¸ RS485/Modbus"]
        SSR["SSR Control<br>âš¡ Heating Element"]
  end
 subgraph NET["ğŸŒ Network Stack"]
        WIFI_MGR["WiFi Manager<br>ğŸ“¶ Connection Handler"]
        MDNS["mDNS Service<br>ğŸ” horno.local"]
        WS_SERVER["WebSocket Server<br>ğŸ“¡ Port 8080"]
        PROV["WiFi Provisioning<br>ğŸ” NVS + BLE*"]
  end
 subgraph UI["ğŸ–¥ï¸ User Interface"]
        LVGL["LVGL GUI<br>ğŸ¨ Touch Interface"]
        STATUS["Status Bar<br>ğŸ“Š Network Icons"]
  end
 subgraph ESP32["ğŸ”Œ ESP32-S3 Heat Controller"]
        CORE
        NET
        UI
  end
 subgraph NETWORK["ğŸŒ Local Network"]
        ROUTER["ğŸ  WiFi Router<br>DHCP + Internet"]
        CLIENT_WEB["ğŸ’» Web Browser<br>React/Vue/JS App"]
        CLIENT_MOBILE["ğŸ“± Mobile App<br>React Native/Flutter"]
        DISCOVERY["ğŸ” mDNS Browser<br>Network Discovery"]
  end
 subgraph EXTERNAL["â˜ï¸ External Services"]
        NTP["ğŸ• NTP Servers<br>Time Sync"]
        GITHUB["ğŸ“¦ GitHub Releases<br>OTA Updates"]
  end
    ESP32 -. WiFi WPA2/3 .-> ROUTER
    ROUTER -- Internet --> NTP & GITHUB
    WIFI_MGR -- Obtiene IP --> MDNS
    MDNS -- "Anuncia _ws._tcp:8080" --> DISCOVERY
    WIFI_MGR -- "Auto-start" --> WS_SERVER
    CLIENT_WEB -- "ws://horno.local:8080/ws" --> WS_SERVER
    CLIENT_MOBILE -- "ws://horno.local:8080/ws" --> WS_SERVER
    DISCOVERY -- "Encuentra horno.local" --> CLIENT_WEB
    PID -- Estado --> WS_SERVER
    SENSOR -- Temperatura --> PID
    WS_SERVER -- Comandos --> PID
    NET -- Estado conexiÃ³n --> STATUS
