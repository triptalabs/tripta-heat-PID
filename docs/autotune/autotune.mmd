---
config:
  theme: neo-dark
  layout: elk
  flowchart:
    curve: linear
    nodeSpacing: 50
    rankSpacing: 60
    padding: 15
    htmlLabels: false
    useMaxWidth: false
    diagramPadding: 15
---

flowchart TD

%% =====================
%% ðŸŽ¯ PROCESO DE AUTOTUNING PID
%% TriptaLabs Heat Controller
%% =====================

%% DefiniciÃ³n de subgrafos principales
subgraph START["ðŸš€ INICIO"]
    S1["ðŸ“¤ Deshabilitar PID\ndisable_pid()"]
    S2["ðŸ“‹ Cargar ConfiguraciÃ³n"]
    S3{MÃ©todo Seleccionado}
end

subgraph ZN["âš™ï¸ Ziegler-Nichols"]
    Z1["ðŸ” Oscilar Sistema"]
    Z2["â±ï¸ Medir Pu, Amplitude"]
    Z3["ðŸ§® Calcular Ku & PID"]
end

subgraph AH["âš™ï¸ Ã…strÃ¶m-HÃ¤gglund"]
    A1["ðŸ” Oscilar Sistema"]
    A2["â±ï¸ Medir Pu, Amplitude"]
    A3["ðŸ§® Calcular Ku & PID"]
end

subgraph FIN["âœ… FINAL"]
    F1["ðŸ’¾ Guardar ParÃ¡metros"]
    F2["ðŸ”Œ Habilitar PID\nenable_pid()"]
end

%% =====================
%% CONEXIONES PRINCIPALES
%% =====================

%% Secuencia principal
S1 --> S2 --> S3
S3 -- ZN --> Z1 --> Z2 --> Z3 --> F1
S3 -- AH --> A1 --> A2 --> A3 --> F1
F1 --> F2

%% =====================
%% NOTAS TÃ‰CNICAS
%% =====================

%% Agregar notas explicativas
subgraph NOTES["ðŸ“š NOTAS TÃ‰CNICAS"]
    N1["ðŸ”¬ MÃ‰TODO ZIEGLER-NICHOLS<br/>â€¢ Relay Feedback Method<br/>â€¢ OscilaciÃ³n controlada del sistema<br/>â€¢ CÃ¡lculo de ganancia crÃ­tica (Ku)<br/>â€¢ PerÃ­odo crÃ­tico (Pu)"]
    N2["âš¡ CONTROL SSR<br/>â€¢ CH422G_od_output(0x00) = ON<br/>â€¢ CH422G_od_output(0x02) = OFF<br/>â€¢ Relay feedback con histÃ©resis"]
    N3["ðŸ“Š FÃ“RMULAS ZN<br/>â€¢ Ku = (4*d)/(Ï€*amplitude)<br/>â€¢ d = (relay_high - relay_low)/2<br/>â€¢ Kp = 0.6 * Ku<br/>â€¢ Ki = 1.2 * Ku / Pu<br/>â€¢ Kd = 0.075 * Ku * Pu"]
    N4["ðŸš« ESTADO ACTUAL<br/>CÃ³digo funcional pero deshabilitado<br/>Comentado con #if 0<br/>No hay API pÃºblica"]
end

style N1 fill:#E1F5FE,stroke:#0277BD,color:#000000
style N2 fill:#E8F5E8,stroke:#388E3C,color:#000000  
style N3 fill:#FFF3E0,stroke:#F57C00,color:#000000
style N4 fill:#FFEBEE,stroke:#D32F2F,color:#000000 